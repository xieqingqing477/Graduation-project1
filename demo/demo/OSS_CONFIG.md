# 阿里云OSS配置说明

本文档说明如何配置阿里云OSS对象存储服务，用于AI试衣功能的图片上传。

## 一、开通阿里云OSS服务

### 重要提示：OOS ≠ OSS

- **OOS**：系统运维管理服务（您当前看到的页面）
- **OSS**：对象存储服务（我们需要使用的服务）

### 如何找到OSS服务

1. 登录 [阿里云控制台](https://ecs.console.aliyun.com/)
2. 在顶部搜索框输入 **"OSS"** 或 **"对象存储"**
3. 点击搜索结果中的 **"对象存储OSS"** 服务
4. 或者直接访问：https://oss.console.aliyun.com/

### 开通OSS服务

1. 进入OSS控制台后，如果是首次使用，会提示开通服务
2. 点击 **"开通"** 或 **"立即开通"**
3. 确认服务协议，开通即可（免费开通，按使用量计费）

**注意**：
- 如果看到"参数配置"页面，显示"计费周期: 1小时"，这是正常的
- 这只是说明按小时计费，**不是只能使用1小时**
- 点击 **"去支付"** 完成开通（首次开通通常是¥0.00，因为有免费额度）
- 开通后可以**永久使用**，没有时间限制

## 二、创建Bucket（存储空间）

1. 在OSS控制台，点击 **创建Bucket**
2. 配置Bucket信息：
   - **Bucket名称**：自定义（如：`my-hanfu-images`）
   - **地域**：选择离您最近的地域（如：`oss-cn-beijing`）
   - **读写权限**：选择 **公共读**（这样生成的URL才能被阿里云API访问）

### 关于"公共读"的说明

**什么是"公共读"？**

- **私有**：只有您（通过AccessKey）可以访问，其他人无法访问
- **公共读**：任何人都可以通过URL直接访问图片，但只有您可以上传/删除
- **公共读写**：任何人都可以访问、上传、删除（不推荐，有安全风险）

**为什么AI试衣功能需要"公共读"？**

1. **阿里云API需要访问图片**：
   - AI试衣API需要从公网下载您上传的图片
   - 如果设置为"私有"，API无法访问图片，会导致失败

2. **生成的URL需要可访问**：
   - 上传图片后，OSS会生成一个公网URL（如：`https://your-bucket.oss-cn-beijing.aliyuncs.com/image.jpg`）
   - 这个URL需要能被阿里云API访问，所以必须设置为"公共读"

3. **安全性说明**：
   - "公共读"只允许读取，不允许修改或删除
   - 只有知道完整URL的人才能访问图片
   - 适合存储公开的图片资源

**如果看到"阻止公共访问"选项：**

- 如果"阻止公共访问"是**开启**状态，需要先**关闭**它
- 然后才能选择"公共读"权限
- 关闭后，选择"公共读"即可

3. 点击 **确定** 创建

## 三、获取AccessKey

### 重要：安全提示

当您进入AccessKey管理页面时，会看到安全警告。有两种选择：

**选项1：使用 RAM 用户 AccessKey（推荐）**
- 更安全，权限最小化
- 适合生产环境或长期使用

**选项2：继续使用云账号 AccessKey（简单）**
- 创建简单，一步到位
- 适合测试环境或毕业设计项目

### 创建步骤

#### 方式一：使用云账号 AccessKey（适合测试）

1. 在阿里云控制台，点击右上角头像
2. 选择 **AccessKey管理**
3. 看到安全提示时，勾选 **"我确认知晓云账号 AccessKey 安全风险"**
4. 点击 **"继续使用云账号 AccessKey"**
5. 点击 **创建AccessKey**
6. 保存 **AccessKey ID** 和 **AccessKey Secret**（只显示一次，请妥善保管）

**重要：配置网络访问策略**

创建AccessKey后，如果看到"AccessKey 级网络访问限制策略"页面：

**对于本地开发环境**：
- 点击 **"允许所有公网访问"** 按钮
- 点击 **"提交"** 保存

**说明**：
- 这个设置限制AccessKey可以从哪些IP使用
- 默认情况下，不配置会拒绝所有公网访问
- 本地开发测试时，允许所有公网访问即可

#### 方式二：使用 RAM 用户 AccessKey（推荐，更安全）

1. 在安全提示页面，点击 **"使用 RAM 用户 AccessKey"**
2. 创建RAM用户并授予OSS权限
3. 为该RAM用户创建AccessKey
4. 保存AccessKey信息

**对于毕业设计项目**：两种方式都可以，选择您觉得方便的即可。

## 四、配置后端环境变量

在项目根目录（`demo/demo/`）创建 `.env` 文件，或修改现有的环境变量配置：

```env
# 阿里云OSS配置
OSS_REGION=oss-cn-beijing
OSS_ACCESS_KEY_ID=your-access-key-id
OSS_ACCESS_KEY_SECRET=your-access-key-secret
OSS_BUCKET=your-bucket-name
```

**说明：**
- `OSS_REGION`：您的Bucket所在地域（如：`oss-cn-beijing`、`oss-cn-shanghai`）
- `OSS_ACCESS_KEY_ID`：您的AccessKey ID
- `OSS_ACCESS_KEY_SECRET`：您的AccessKey Secret
- `OSS_BUCKET`：您的Bucket名称

## 五、安装依赖包

在后端项目目录执行：

```bash
cd demo/demo
npm install ali-oss dotenv
```

或者直接运行项目根目录下的 `安装OSS依赖.bat` 脚本（Windows系统）。

## 六、配置CORS（跨域访问）

1. 在OSS控制台，选择您的Bucket
2. 进入 **权限管理** > **跨域设置**
3. 点击 **创建规则**
4. 配置如下：
   - **来源**：`http://localhost:8080` 或您的域名
   - **允许Methods**：`GET`、`POST`、`PUT`
   - **允许Headers**：`*`
   - **暴露Headers**：`ETag`、`x-oss-request-id`
   - **缓存时间**：`3600`

## 七、重启后端服务器

配置完成后，重启后端服务器：

```bash
cd demo/demo
node src/serve/nodeserve.js
```

## 八、验证配置

1. 在前端上传一张图片
2. 检查返回的URL是否为OSS公网地址（格式：`https://your-bucket.oss-cn-beijing.aliyuncs.com/...`）
3. 在浏览器中访问该URL，确认图片可以正常显示

## 费用说明

### OSS不需要购买服务器！

**重要说明**：
- **OSS（对象存储）** 和 **ECS（云服务器）** 是不同的服务
- 使用OSS **不需要购买服务器**，OSS是独立的存储服务
- OSS按实际使用量计费，有**免费额度**可以使用

### 免费额度（新用户）

阿里云OSS为新用户提供免费额度：

1. **存储容量**：每月5GB免费存储空间
2. **流量**：每月5GB免费下行流量（下载流量）
3. **请求次数**：每月5万次PUT请求，20万次GET请求

### 计费说明

**重要：关于"计费周期: 1小时"**

页面显示的"计费周期: 1小时"**不是使用时长限制**，而是：
- **计费方式**：按小时计费（每小时结算一次费用）
- **使用时长**：可以**永久使用**，没有时间限制
- **按量付费**：用多少付多少，不用不收费

**打个比方**：
- 就像手机话费，按分钟计费，但可以一直使用
- OSS按小时计费，但可以一直使用，没有到期时间

### 费用详情

超出免费额度后，按实际使用量计费（价格很低）：
- **存储费用**：约 0.12元/GB/月（按小时折算）
- **流量费用**：约 0.5元/GB（下行流量）
- **请求费用**：约 0.01元/万次

**对于个人项目或毕业设计**：
- 通常免费额度就够用了
- 如果只是测试AI试衣功能，使用量很小
- 可以放心使用，基本不会产生费用
- **可以一直使用，没有时间限制**

### 如何查看费用

1. 登录阿里云控制台
2. 进入 **费用中心** > **费用账单**
3. 可以设置费用预警，避免意外扣费

## 注意事项

1. **安全性**：不要将AccessKey提交到代码仓库，使用环境变量管理
2. **权限设置**：Bucket设置为"公共读"后，任何人都可以通过URL访问图片，请确保图片内容符合相关法律法规
3. **地域选择**：选择离您最近的地域，可以降低延迟和费用
4. **费用控制**：建议设置费用预警，超出免费额度时会收到通知

## 其他对象存储服务

除了阿里云OSS，您也可以使用：
- 腾讯云COS
- 七牛云
- 又拍云
- 其他支持公网访问的对象存储服务

配置方法类似，需要修改后端上传代码以适配相应的SDK。


本文档说明如何配置阿里云OSS对象存储服务，用于AI试衣功能的图片上传。

## 一、开通阿里云OSS服务

### 重要提示：OOS ≠ OSS

- **OOS**：系统运维管理服务（您当前看到的页面）
- **OSS**：对象存储服务（我们需要使用的服务）

### 如何找到OSS服务

1. 登录 [阿里云控制台](https://ecs.console.aliyun.com/)
2. 在顶部搜索框输入 **"OSS"** 或 **"对象存储"**
3. 点击搜索结果中的 **"对象存储OSS"** 服务
4. 或者直接访问：https://oss.console.aliyun.com/

### 开通OSS服务

1. 进入OSS控制台后，如果是首次使用，会提示开通服务
2. 点击 **"开通"** 或 **"立即开通"**
3. 确认服务协议，开通即可（免费开通，按使用量计费）

**注意**：
- 如果看到"参数配置"页面，显示"计费周期: 1小时"，这是正常的
- 这只是说明按小时计费，**不是只能使用1小时**
- 点击 **"去支付"** 完成开通（首次开通通常是¥0.00，因为有免费额度）
- 开通后可以**永久使用**，没有时间限制

## 二、创建Bucket（存储空间）

1. 在OSS控制台，点击 **创建Bucket**
2. 配置Bucket信息：
   - **Bucket名称**：自定义（如：`my-hanfu-images`）
   - **地域**：选择离您最近的地域（如：`oss-cn-beijing`）
   - **读写权限**：选择 **公共读**（这样生成的URL才能被阿里云API访问）

### 关于"公共读"的说明

**什么是"公共读"？**

- **私有**：只有您（通过AccessKey）可以访问，其他人无法访问
- **公共读**：任何人都可以通过URL直接访问图片，但只有您可以上传/删除
- **公共读写**：任何人都可以访问、上传、删除（不推荐，有安全风险）

**为什么AI试衣功能需要"公共读"？**

1. **阿里云API需要访问图片**：
   - AI试衣API需要从公网下载您上传的图片
   - 如果设置为"私有"，API无法访问图片，会导致失败

2. **生成的URL需要可访问**：
   - 上传图片后，OSS会生成一个公网URL（如：`https://your-bucket.oss-cn-beijing.aliyuncs.com/image.jpg`）
   - 这个URL需要能被阿里云API访问，所以必须设置为"公共读"

3. **安全性说明**：
   - "公共读"只允许读取，不允许修改或删除
   - 只有知道完整URL的人才能访问图片
   - 适合存储公开的图片资源

**如果看到"阻止公共访问"选项：**

- 如果"阻止公共访问"是**开启**状态，需要先**关闭**它
- 然后才能选择"公共读"权限
- 关闭后，选择"公共读"即可

3. 点击 **确定** 创建

## 三、获取AccessKey

### 重要：安全提示

当您进入AccessKey管理页面时，会看到安全警告。有两种选择：

**选项1：使用 RAM 用户 AccessKey（推荐）**
- 更安全，权限最小化
- 适合生产环境或长期使用

**选项2：继续使用云账号 AccessKey（简单）**
- 创建简单，一步到位
- 适合测试环境或毕业设计项目

### 创建步骤

#### 方式一：使用云账号 AccessKey（适合测试）

1. 在阿里云控制台，点击右上角头像
2. 选择 **AccessKey管理**
3. 看到安全提示时，勾选 **"我确认知晓云账号 AccessKey 安全风险"**
4. 点击 **"继续使用云账号 AccessKey"**
5. 点击 **创建AccessKey**
6. 保存 **AccessKey ID** 和 **AccessKey Secret**（只显示一次，请妥善保管）

**重要：配置网络访问策略**

创建AccessKey后，如果看到"AccessKey 级网络访问限制策略"页面：

**对于本地开发环境**：
- 点击 **"允许所有公网访问"** 按钮
- 点击 **"提交"** 保存

**说明**：
- 这个设置限制AccessKey可以从哪些IP使用
- 默认情况下，不配置会拒绝所有公网访问
- 本地开发测试时，允许所有公网访问即可

#### 方式二：使用 RAM 用户 AccessKey（推荐，更安全）

1. 在安全提示页面，点击 **"使用 RAM 用户 AccessKey"**
2. 创建RAM用户并授予OSS权限
3. 为该RAM用户创建AccessKey
4. 保存AccessKey信息

**对于毕业设计项目**：两种方式都可以，选择您觉得方便的即可。

## 四、配置后端环境变量

在项目根目录（`demo/demo/`）创建 `.env` 文件，或修改现有的环境变量配置：

```env
# 阿里云OSS配置
OSS_REGION=oss-cn-beijing
OSS_ACCESS_KEY_ID=your-access-key-id
OSS_ACCESS_KEY_SECRET=your-access-key-secret
OSS_BUCKET=your-bucket-name
```

**说明：**
- `OSS_REGION`：您的Bucket所在地域（如：`oss-cn-beijing`、`oss-cn-shanghai`）
- `OSS_ACCESS_KEY_ID`：您的AccessKey ID
- `OSS_ACCESS_KEY_SECRET`：您的AccessKey Secret
- `OSS_BUCKET`：您的Bucket名称

## 五、安装依赖包

在后端项目目录执行：

```bash
cd demo/demo
npm install ali-oss dotenv
```

或者直接运行项目根目录下的 `安装OSS依赖.bat` 脚本（Windows系统）。

## 六、配置CORS（跨域访问）

1. 在OSS控制台，选择您的Bucket
2. 进入 **权限管理** > **跨域设置**
3. 点击 **创建规则**
4. 配置如下：
   - **来源**：`http://localhost:8080` 或您的域名
   - **允许Methods**：`GET`、`POST`、`PUT`
   - **允许Headers**：`*`
   - **暴露Headers**：`ETag`、`x-oss-request-id`
   - **缓存时间**：`3600`

## 七、重启后端服务器

配置完成后，重启后端服务器：

```bash
cd demo/demo
node src/serve/nodeserve.js
```

## 八、验证配置

1. 在前端上传一张图片
2. 检查返回的URL是否为OSS公网地址（格式：`https://your-bucket.oss-cn-beijing.aliyuncs.com/...`）
3. 在浏览器中访问该URL，确认图片可以正常显示

## 费用说明

### OSS不需要购买服务器！

**重要说明**：
- **OSS（对象存储）** 和 **ECS（云服务器）** 是不同的服务
- 使用OSS **不需要购买服务器**，OSS是独立的存储服务
- OSS按实际使用量计费，有**免费额度**可以使用

### 免费额度（新用户）

阿里云OSS为新用户提供免费额度：

1. **存储容量**：每月5GB免费存储空间
2. **流量**：每月5GB免费下行流量（下载流量）
3. **请求次数**：每月5万次PUT请求，20万次GET请求

### 计费说明

**重要：关于"计费周期: 1小时"**

页面显示的"计费周期: 1小时"**不是使用时长限制**，而是：
- **计费方式**：按小时计费（每小时结算一次费用）
- **使用时长**：可以**永久使用**，没有时间限制
- **按量付费**：用多少付多少，不用不收费

**打个比方**：
- 就像手机话费，按分钟计费，但可以一直使用
- OSS按小时计费，但可以一直使用，没有到期时间

### 费用详情

超出免费额度后，按实际使用量计费（价格很低）：
- **存储费用**：约 0.12元/GB/月（按小时折算）
- **流量费用**：约 0.5元/GB（下行流量）
- **请求费用**：约 0.01元/万次

**对于个人项目或毕业设计**：
- 通常免费额度就够用了
- 如果只是测试AI试衣功能，使用量很小
- 可以放心使用，基本不会产生费用
- **可以一直使用，没有时间限制**

### 如何查看费用

1. 登录阿里云控制台
2. 进入 **费用中心** > **费用账单**
3. 可以设置费用预警，避免意外扣费

## 注意事项

1. **安全性**：不要将AccessKey提交到代码仓库，使用环境变量管理
2. **权限设置**：Bucket设置为"公共读"后，任何人都可以通过URL访问图片，请确保图片内容符合相关法律法规
3. **地域选择**：选择离您最近的地域，可以降低延迟和费用
4. **费用控制**：建议设置费用预警，超出免费额度时会收到通知

## 其他对象存储服务

除了阿里云OSS，您也可以使用：
- 腾讯云COS
- 七牛云
- 又拍云
- 其他支持公网访问的对象存储服务

配置方法类似，需要修改后端上传代码以适配相应的SDK。





